
# 리그오브레전드 전적사이트 (feat. fow.kr, OP.GG)



주요 기능(v1)
- 소환사 검색
- 랭크 정보
- 최근 전적 정보 (20개)
- 현재 진행중인 게임 정보


도메이별로 기능을 구현했으며 타 도메인간의 의존관계를 형성하지 않도록 개발을 진행했습니다.

API를 통한 데이터를 얻어 데이터베이스에 데이터를 쌓도록 기능 구현했습니다.

## 이슈사항
- 현재버전에서는 소환사검색후 매치20개 정보를 가져오는 API 속도가 느림(대략 5~10초걸림) -> 수정중
  - 원인 : 불필요한 데이터(상세정보들)까지 검색시 가져오기 때문(다수의 테이블에서 정보를 가져옴)
  - 해결법
    - 불필요한 테이블 조회를 줄이고 필요한 정보만 표출하도록 수정
    - 상세정보는 상세정보 선택시 데이터를 가져오도록 수정
## 고민거리
- 소환사별로 과거 데이터는 어떻게 구할 수 있을까? 
  - 현재기준(23.03.25) 롤 공식 API는 최근 20게임정보만 제공
  - 스프링 배치로 전체 소환사에 대한 정보를 데이터베이스에 수집하면 어떨까에 대한 생각을 했지만 전체 소환사 이름을 얻을 수가 없음.

## 성능개선이력
- 조회성능개선(450ms -> 280ms)
  - 크게 줄진 않음.
  - 정말로 문제가 됐던건 DB 커넥션이 많이 일어나는게 문제였음
- DB 커넥션 수 감소
  - 수정전 
    - 커넥션 수 계산 : 전체게임수(20게임) * 한게임참여자수(10명) * 한게임팀수(2팀) * 챔피언밴수(한팀당 5개) ...
    - 이미 한게임으로 일어나는 DB커넥션수가 너무 많음
    - @OneToMany로 관련된 엔티티가 많아 N+1 조회성능문제가 발생
  - 수정후
    - 커넥션 수 계산 : 게임정보(1) + 해당 게임에 대한 참여자정보(1) + 해당 게임에 대한 팀 및 밴 정보(1)
    - @OneToMany로 엮여있는 엔티티가 많아 최대한 분할하여 정보를 가져와 합치는 방향으로 수정
    - fetchjoin활용하여 연관된 엔티티를 함께 가져옴
    - 한 게임씩 정보를 가져오는 방법 -> 전체 20게임 정보를 가져오는 방법으로(쿼리 변경 where in으로)
  


기술 요구사항
- 
- 개발언어 : Java 11
- 프레임워크 : SpringBoot
- ORM : JPA
- DB : Mysql/H2
